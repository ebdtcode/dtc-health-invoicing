<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daytocare Health Services - Invoice</title>
    <link rel="icon" type="image/x-icon" href="./favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        daytocare: '#C9354D',
                        'daytocare-light': '#FFF5F7',
                    },
                    fontFamily: {
                        sans: ['-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Helvetica Neue', 'Arial', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #C9354D 0%, #D84A5F 100%);
            padding: 30px 20px;
            color: #333;
            line-height: 1.4;
        }

        .nav-bar {
            max-width: 900px;
            margin: 0 auto 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: white;
            color: #C9354D;
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 500;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            display: inline-block;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .nav-btn.active {
            background: rgba(255, 255, 255, 0.3);
            color: white;
            border: 2px solid white;
        }

        .invoice-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .invoice-header {
            background: linear-gradient(135deg, #C9354D 0%, #D84A5F 100%);
            color: white;
            padding: 15px 25px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .logo-container {
            background: white;
            padding: 8px 20px;
            border-radius: 8px;
            display: inline-block;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .logo-container img {
            height: 40px;
            width: auto;
            display: block;
        }

        .invoice-header h1 {
            font-size: 1.6em;
            margin-bottom: 4px;
            font-weight: 300;
            letter-spacing: 1.2px;
        }

        .invoice-header p {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .invoice-body {
            padding: 25px 30px;
        }

        .info-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .info-box {
            background: #fff5f7;
            padding: 18px 20px;
            border-radius: 10px;
            border-left: 3px solid #C9354D;
        }

        .info-box h3 {
            color: #C9354D;
            font-size: 0.95em;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            font-weight: 600;
        }

        .info-box p {
            line-height: 1.6;
            color: #555;
            font-size: 0.95em;
        }

        .info-box strong {
            color: #333;
            display: inline-block;
            min-width: 120px;
        }

        .invoice-details {
            margin-bottom: 25px;
        }

        .invoice-details h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid #C9354D;
            padding-bottom: 8px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        thead {
            background: linear-gradient(135deg, #C9354D 0%, #D84A5F 100%);
            color: white;
        }

        th {
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            font-size: 0.85em;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            font-size: 0.95em;
        }

        tbody tr:hover {
            background: #fff5f7;
            transition: background 0.3s ease;
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

        .amount-column {
            text-align: right;
            font-weight: 600;
            color: #C9354D;
        }

        .total-section {
            background: linear-gradient(135deg, #fff5f7 0%, #ffe4e9 100%);
            padding: 20px 25px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 1em;
        }

        .total-row.grand-total {
            font-size: 1.3em;
            font-weight: bold;
            color: #C9354D;
            border-top: 2px solid #C9354D;
            padding-top: 15px;
            margin-top: 15px;
        }

        .notes-section {
            margin-top: 25px;
            padding: 18px 20px;
            background: #f0f4f8;
            border-left: 3px solid #C9354D;
            border-radius: 8px;
        }

        .notes-section h3 {
            color: #C9354D;
            margin-bottom: 12px;
            font-size: 1.05em;
        }

        .notes-section p {
            line-height: 1.6;
            color: #666;
            font-size: 0.95em;
        }

        .footer {
            background: #fff5f7;
            padding: 20px 30px;
            text-align: center;
            color: #666;
            border-top: 2px solid #C9354D;
            font-size: 0.95em;
        }

        .footer p {
            margin-bottom: 8px;
        }

        .editable {
            background: #fff3cd;
            padding: 2px 6px;
            border-radius: 4px;
            border: 1px dashed #ffc107;
            min-width: 100px;
            display: inline-block;
        }

        .control-panel {
            background: linear-gradient(135deg, #C9354D 0%, #D84A5F 100%);
            padding: 30px;
            margin-bottom: 0;
        }

        .control-panel h2 {
            color: white;
            margin-bottom: 20px;
            font-size: 1.5em;
            text-align: center;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            color: white;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .form-group input,
        .form-group textarea {
            padding: 10px;
            border: none;
            border-radius: 6px;
            font-size: 1em;
            font-family: inherit;
            background: white;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 60px;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: stretch;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;
            min-width: 180px;
        }

        button .icon {
            font-size: 1.8em;
            display: block;
        }

        .btn-primary {
            background: white;
            color: #C9354D;
        }

        .btn-primary:hover {
            background: #fff5f7;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .btn-secondary {
            background: #A82C41;
            color: white;
        }

        .btn-secondary:hover {
            background: #8F2537;
            transform: translateY(-2px);
        }

        .btn-download {
            background: #8B4C52;
            color: white;
        }

        .btn-download:hover {
            background: #6D3A3F;
            transform: translateY(-2px);
        }

        .btn-reset {
            background: #dc2626;
            color: white;
        }

        .btn-reset:hover {
            background: #b91c1c;
            transform: translateY(-2px);
        }

        .line-items-section {
            margin-top: 30px;
        }

        .line-item {
            display: grid;
            grid-template-columns: 150px 2fr 100px 100px 30px;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .line-item input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .remove-line {
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .add-line-btn {
            background: white;
            color: #C9354D;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 10px;
            font-weight: 600;
        }

        .paypal-button {
            display: inline-block;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .paypal-button:hover .paypal-button-label-container {
            background: #F0B429 !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .paypal-button:active .paypal-button-label-container {
            transform: translateY(0);
        }

        @media print {
            @page {
                size: letter landscape;
                margin: 0.3in 0.4in;
            }

            body {
                background: white;
                padding: 0;
                font-family: Georgia, 'Times New Roman', serif;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            * {
                max-height: 100%;
            }

            /* Hide navigation and control elements */
            nav {
                display: none !important;
            }

            .control-panel {
                display: none !important;
            }

            /* Container adjustments for print */
            .max-w-6xl {
                max-width: 100% !important;
            }

            .rounded-3xl {
                border-radius: 0 !important;
            }

            .shadow-2xl {
                box-shadow: none !important;
            }

            .invoice-container {
                box-shadow: none;
                border-radius: 0;
                max-width: 100%;
                page-break-after: avoid;
            }

            .editable {
                background: transparent;
                border: none;
            }

            .invoice-header {
                padding: 10px 15px;
                page-break-inside: avoid;
            }

            .logo-container {
                padding: 5px 15px;
                margin-bottom: 8px;
            }

            .logo-container img {
                height: 35px;
            }

            .invoice-header h1 {
                font-size: 1.4em;
                margin-bottom: 3px;
            }

            .invoice-header p {
                font-size: 0.85em;
            }

            .invoice-body {
                padding: 10px 15px;
            }

            .info-section {
                margin-bottom: 10px;
                gap: 12px;
                page-break-inside: avoid;
            }

            .info-box {
                padding: 8px 12px;
            }

            .info-box h3 {
                font-size: 0.75em;
                margin-bottom: 6px;
            }

            .info-box p {
                font-size: 0.8em;
                line-height: 1.4;
            }

            .invoice-details h2 {
                font-size: 1em;
                margin-bottom: 8px;
                padding-bottom: 4px;
            }

            table {
                page-break-inside: avoid;
                margin-bottom: 10px;
                font-size: 0.9em;
            }

            th {
                padding: 6px 8px;
                font-size: 0.75em;
            }

            td {
                padding: 6px 8px;
                font-size: 0.8em;
            }

            .total-section {
                padding: 10px 15px;
                margin-top: 10px;
                page-break-inside: avoid;
            }

            .total-row {
                margin-bottom: 6px;
                font-size: 0.85em;
            }

            .total-row.grand-total {
                font-size: 1em;
                padding-top: 8px;
                margin-top: 8px;
            }

            .notes-section {
                padding: 8px 12px;
                margin-top: 10px;
                page-break-inside: avoid;
            }

            .notes-section h3 {
                font-size: 0.85em;
                margin-bottom: 5px;
            }

            .notes-section p {
                font-size: 0.75em;
                line-height: 1.4;
            }

            .footer {
                padding: 8px 15px;
                font-size: 0.7em;
                page-break-inside: avoid;
            }

            .footer p {
                margin-bottom: 3px;
            }

            /* Hide payment buttons in print */
            .notes-section > div {
                display: none !important;
            }
        }

        @media (max-width: 768px) {
            .info-section {
                grid-template-columns: 1fr;
            }

            .invoice-header h1 {
                font-size: 1.8em;
            }

            th, td {
                padding: 12px 8px;
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-daytocare via-red-500 to-pink-600 min-h-screen py-8 px-4">
    <!-- Navigation Bar -->
    <nav class="max-w-6xl mx-auto mb-8 bg-white/10 backdrop-blur-md rounded-2xl px-6 py-4 shadow-xl">
        <div class="flex flex-wrap gap-3 justify-center">
            <a href="home.html" class="px-6 py-3 bg-white/20 hover:bg-white/30 text-white font-medium rounded-xl transition-all duration-300 hover:-translate-y-0.5 hover:shadow-lg">
                üè† Home
            </a>
            <a href="index.html" class="px-6 py-3 bg-white text-daytocare font-semibold rounded-xl transition-all duration-300 shadow-lg border-2 border-white">
                üìÑ Invoice Generator
            </a>
            <a href="timesheet.html" class="px-6 py-3 bg-white/20 hover:bg-white/30 text-white font-medium rounded-xl transition-all duration-300 hover:-translate-y-0.5 hover:shadow-lg">
                üìä Timesheet Generator
            </a>
        </div>
    </nav>
    
    <!-- Main Container -->
    <div class="max-w-6xl mx-auto bg-white rounded-3xl shadow-2xl overflow-hidden">
        <!-- Control Panel -->
        <div class="control-panel bg-gradient-to-r from-daytocare to-red-500 p-8">
            <h2 class="text-3xl font-bold text-white mb-6">üìã Invoice Generator</h2>
            
            <div class="form-grid">
                <div class="form-group has-value">
                    <input type="text" id="contractorName" placeholder=" " value="YYYY (Your Name)">
                    <label>Your Name</label>
                </div>
                <div class="form-group has-value">
                    <input type="text" id="position" placeholder=" " value="Delegating Nurse">
                    <label>Position</label>
                </div>
                <div class="form-group has-value">
                    <input type="text" id="license" placeholder=" " value="RN-XXXXXX">
                    <label>License #</label>
                </div>
                <div class="form-group has-value">
                    <input type="email" id="contractorEmail" placeholder=" " value="your.email@example.com">
                    <label>Your Email</label>
                </div>
                <div class="form-group has-value">
                    <input type="tel" id="contractorPhone" placeholder=" " value="(555) 123-4567">
                    <label>Your Phone</label>
                </div>
                <div class="form-group has-value">
                    <input type="text" id="facilityName" placeholder=" " value="xxxx Assisted Living">
                    <label>Facility Name</label>
                </div>
                <div class="form-group has-value">
                    <input type="text" id="attention" placeholder=" " value="VP of Clinical Services">
                    <label>Attention To</label>
                </div>
                <div class="form-group has-value">
                    <input type="text" id="facilityAddress" placeholder=" " value="Facility Address">
                    <label>Facility Address</label>
                </div>
                <div class="form-group has-value">
                    <input type="email" id="facilityEmail" placeholder=" " value="billing@facility.com">
                    <label>Facility Email</label>
                </div>
                <div class="form-group has-value">
                    <input type="tel" id="facilityPhone" placeholder=" " value="(555) 987-6543">
                    <label>Facility Phone</label>
                </div>
                <div class="form-group has-value">
                    <input type="text" id="invoiceNumber" placeholder=" " value="INV-2025-001" readonly style="background: rgba(255, 255, 255, 0.7); cursor: not-allowed;">
                    <label>Invoice Number</label>
                    <small style="color: white; font-size: 0.75em; margin-top: 6px; display: block; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);">Auto-generated</small>
                </div>
                <div class="form-group has-value">
                    <input type="date" id="invoiceDate" placeholder=" " value="2025-10-15">
                    <label>Invoice Date</label>
                </div>
                <div class="form-group has-value">
                    <input type="date" id="periodStart" placeholder=" " value="2025-10-01">
                    <label>Period Start Date</label>
                </div>
                <div class="form-group has-value">
                    <input type="date" id="periodEnd" placeholder=" " value="2025-10-15">
                    <label>Period End Date</label>
                </div>
                <div class="form-group has-value">
                    <input type="date" id="dueDate" placeholder=" " value="2025-10-30">
                    <label>Due Date</label>
                </div>
                <div class="form-group has-value">
                    <input type="number" id="hourlyRate" placeholder=" " value="65" step="0.01">
                    <label>Hourly Rate ($)</label>
                </div>
            </div>

            <div class="form-group textarea-group has-value">
                <textarea id="paymentInfo" placeholder=" ">Please make payment via check/ACH/wire transfer
Bank Name - Account #XXXX-XXXX</textarea>
                <label>Payment Method & Account Details</label>
            </div>

            <!-- Line Items Manager -->
            <div style="margin-top: 30px; padding: 25px; background: rgba(255,255,255,0.1); border-radius: 12px;">
                <h3 style="color: white; margin-bottom: 20px; display: flex; align-items: center; justify-content: space-between;">
                    üìã Billing Period Line Items
                    <button class="btn-secondary" id="addLineItemBtn" style="padding: 8px 15px;">‚ûï Add Line Item</button>
                </h3>
                
                <div id="lineItemsManager" style="display: flex; flex-direction: column; gap: 15px;">
                    <!-- Line items will be rendered here -->
                </div>
            </div>

            <div class="button-group">
                <button class="btn-primary" id="updateInvoiceBtn">
                    <span class="icon">üîÑ</span>
                    <span>Update<br>Invoice</span>
                </button>
                <button class="btn-secondary" id="printInvoiceBtn">
                    <span class="icon">üñ®Ô∏è</span>
                    <span>Print<br>Invoice</span>
                </button>
                <button class="btn-download" id="downloadPDFBtn">
                    <span class="icon">üìÑ</span>
                    <span>Download<br>PDF</span>
                </button>
                <button class="btn-secondary" id="autoGenerateBtn">
                    <span class="icon">‚ö°</span>
                    <span>Auto-Generate<br>from Period</span>
                </button>
                <button class="btn-reset" id="resetCounterBtn">
                    <span class="icon">üî¢</span>
                    <span>Reset<br>Counter</span>
                </button>
            </div>
        </div>

        <div class="invoice-header">
            <div class="logo-container">
                <img src="./assets/images/dtc_logo.png" alt="Daytocare Health Logo">
            </div>
            <h1>INVOICE</h1>
            <p>Professional Nursing Services</p>
        </div>

        <div class="invoice-body">
            <div class="info-section">
                <div class="info-box">
                    <h3>From</h3>
                    <p>
                        <strong>Contractor:</strong> <span id="display-contractorName">YYYY (Your Name)</span><br>
                        <strong>Position:</strong> <span id="display-position">Delegating Nurse</span><br>
                        <strong>License #:</strong> <span id="display-license">RN-XXXXXX</span><br>
                        <strong>Email:</strong> <span id="display-contractorEmail">your.email@example.com</span><br>
                        <strong>Phone:</strong> <span id="display-contractorPhone">(555) 123-4567</span>
                    </p>
                </div>

                <div class="info-box">
                    <h3>To</h3>
                    <p>
                        <strong>Facility:</strong> <span id="display-facilityName">xxxx Assisted Living</span><br>
                        <strong>Attn:</strong> <span id="display-attention">VP of Clinical Services</span><br>
                        <strong>Address:</strong> <span id="display-facilityAddress">Facility Address</span><br>
                        <strong>Email:</strong> <span id="display-facilityEmail">billing@facility.com</span><br>
                        <strong>Phone:</strong> <span id="display-facilityPhone">(555) 987-6543</span>
                    </p>
                </div>
            </div>

            <div class="info-section">
                <div class="info-box">
                    <h3>Invoice Details</h3>
                    <p>
                        <strong>Invoice #:</strong> <span id="display-invoiceNumber">INV-2025-001</span><br>
                        <strong>Invoice Date:</strong> <span id="display-invoiceDate">October 15, 2025</span><br>
                        <strong>Billing Period:</strong> <span id="display-billingPeriod">Oct 1 - Oct 15, 2025</span>
                    </p>
                </div>

                <div class="info-box">
                    <h3>Payment Details</h3>
                    <p>
                        <strong>Due Date:</strong> <span id="display-dueDate">October 30, 2025</span><br>
                        <strong>Payment Terms:</strong> Net 15 Days<br>
                        <strong>Hourly Rate:</strong> $<span id="display-hourlyRate">65.00</span>
                    </p>
                </div>
            </div>

            <div class="invoice-details">
                <h2>Services Provided</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Description</th>
                            <th style="text-align: center;">Hours</th>
                            <th style="text-align: right;">Rate</th>
                            <th style="text-align: right;">Amount</th>
                        </tr>
                    </thead>
                    <tbody id="lineItemsTable">
                        <tr data-line-index="0">
                            <td>Oct 01, 2025</td>
                            <td>Delegating Nurse Services - Week 1</td>
                            <td style="text-align: center;">10.0</td>
                            <td class="amount-column">$65.00</td>
                            <td class="amount-column">$650.00</td>
                        </tr>
                        <tr data-line-index="1">
                            <td>Oct 08, 2025</td>
                            <td>Delegating Nurse Services - Week 2</td>
                            <td style="text-align: center;">10.0</td>
                            <td class="amount-column">$65.00</td>
                            <td class="amount-column">$650.00</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="total-section">
                <div class="total-row">
                    <span>Subtotal:</span>
                    <span>$<span id="display-subtotal">1,300.00</span></span>
                </div>
                <div class="total-row">
                    <span>Tax (If Applicable):</span>
                    <span>$<span id="display-tax">0.00</span></span>
                </div>
                <div class="total-row grand-total">
                    <span>TOTAL DUE:</span>
                    <span>$<span id="display-total">1,300.00</span></span>
                </div>
            </div>

            <div class="notes-section">
                <h3>Payment Information & Notes</h3>
                <p id="display-paymentInfo">
                    <strong>Payment Method:</strong> Please make payment via check/ACH/wire transfer<br>
                    <strong>Account Details:</strong> Bank Name - Account #XXXX-XXXX
                </p>
                
                <div style="margin-top: 25px; padding-top: 20px; border-top: 2px solid #e0e0e0;">
                    <p style="margin-bottom: 15px;"><strong>Alternative Payment Options:</strong></p>
                    
                    <!-- PayPal -->
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                        <span style="color: #666;">Pay securely with PayPal:</span>
                        <div class="paypal-button-row paypal-button-number-0 paypal-button-layout-vertical paypal-button-number-multiple paypal-button-env-production paypal-button-color-gold paypal-button-text-color-black paypal-logo-color-blue paypal-button-shape-rect">
                            <div role="link" data-button="" data-funding-source="paypal" class="paypal-button paypal-button-number-0 paypal-button-layout-vertical paypal-button-number-multiple paypal-button-env-production paypal-button-color-gold paypal-button-text-color-black paypal-logo-color-blue paypal-button-shape-rect" tabindex="0" aria-label="PayPal Checkout" style="cursor: pointer;">
                                <div class="paypal-button-label-container" style="display: flex; align-items: center; gap: 8px; background: #FFC439; padding: 10px 20px; border-radius: 4px; transition: all 0.3s ease;">
                                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAxcHgiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAxMDEgMzIiIHByZXNlcnZlQXNwZWN0UmF0aW89InhNaW5ZTWluIG1lZXQiIHhtbG5zPSJodHRwOiYjeDJGOyYjeDJGO3d3dy53My5vcmcmI3gyRjsyMDAwJiN4MkY7c3ZnIj48cGF0aCBmaWxsPSIjMDAzMDg3IiBkPSJNIDEyLjIzNyAyLjggTCA0LjQzNyAyLjggQyAzLjkzNyAyLjggMy40MzcgMy4yIDMuMzM3IDMuNyBMIDAuMjM3IDIzLjcgQyAwLjEzNyAyNC4xIDAuNDM3IDI0LjQgMC44MzcgMjQuNCBMIDQuNTM3IDI0LjQgQyA1LjAzNyAyNC40IDUuNTM3IDI0IDUuNjM3IDIzLjUgTCA2LjQzNyAxOC4xIEMgNi41MzcgMTcuNiA2LjkzNyAxNy4yIDcuNTM3IDE3LjIgTCAxMC4wMzcgMTcuMiBDIDE1LjEzNyAxNy4yIDE4LjEzNyAxNC43IDE4LjkzNyA5LjggQyAxOS4yMzcgNy43IDE4LjkzNyA2IDE3LjkzNyA0LjggQyAxNi44MzcgMy41IDE0LjgzNyAyLjggMTIuMjM3IDIuOCBaIE0gMTMuMTM3IDEwLjEgQyAxMi43MzcgMTIuOSAxMC41MzcgMTIuOSA4LjUzNyAxMi45IEwgNy4zMzcgMTIuOSBMIDguMTM3IDcuNyBDIDguMTM3IDcuNCA4LjQzNyA3LjIgOC43MzcgNy4yIEwgOS4yMzcgNy4yIEMgMTAuNjM3IDcuMiAxMS45MzcgNy4yIDEyLjYzNyA4IEMgMTMuMTM3IDguNCAxMy4zMzcgOS4xIDEzLjEzNyAxMC4xIFoiPjwvcGF0aD48cGF0aCBmaWxsPSIjMDAzMDg3IiBkPSJNIDM1LjQzNyAxMCBMIDMxLjczNyAxMCBDIDMxLjQzNyAxMCAzMS4xMzcgMTAuMiAzMS4xMzcgMTAuNSBMIDMwLjkzNyAxMS41IEwgMzAuNjM3IDExLjEgQyAyOS44MzcgOS45IDI4LjAzNyA5LjUgMjYuMjM3IDkuNSBDIDIyLjEzNyA5LjUgMTguNjM3IDEyLjYgMTcuOTM3IDE3IEMgMTcuNTM3IDE5LjIgMTguMDM3IDIxLjMgMTkuMzM3IDIyLjcgQyAyMC40MzcgMjQgMjIuMTM3IDI0LjYgMjQuMDM3IDI0LjYgQyAyNy4zMzcgMjQuNiAyOS4yMzcgMjIuNSAyOS4yMzcgMjIuNSBMIDI5LjAzNyAyMy41IEMgMjguOTM3IDIzLjkgMjkuMjM3IDI0LjMgMjkuNjM3IDI0LjMgTCAzMy4wMzcgMjQuMyBDIDMzLjUzNyAyNC4zIDM0LjAzNyAyMy45IDM0LjEzNyAyMy40IEwgMzYuMTM3IDEwLjYgQyAzNi4yMzcgMTAuNCAzNS44MzcgMTAgMzUuNDM3IDEwIFogTSAzMC4zMzcgMTcuMiBDIDI5LjkzNyAxOS4zIDI4LjMzNyAyMC44IDI2LjEzNyAyMC44IEMgMjUuMDM3IDIwLjggMjQuMjM3IDIwLjUgMjMuNjM3IDE5LjggQyAyMy4wMzcgMTkuMSAyMi44MzcgMTguMiAyMy4wMzcgMTcuMiBDIDIzLjMzNyAxNS4xIDI1LjEzNyAxMy42IDI3LjIzNyAxMy42IEMgMjguMzM3IDEzLjYgMjkuMTM3IDE0IDI5LjczNyAxNC42IEMgMzAuMjM3IDE1LjMgMzAuNDM3IDE2LjIgMzAuMzM3IDE3LjIgWiI+PC9wYXRoPjxwYXRoIGZpbGw9IiMwMDMwODciIGQ9Ik0gNTUuMzM3IDEwIEwgNTEuNjM3IDEwIEMgNTEuMjM3IDEwIDUwLjkzNyAxMC4yIDUwLjczNyAxMC41IEwgNDUuNTM3IDE4LjEgTCA0My4zMzcgMTAuOCBDIDQzLjIzNyAxMC4zIDQyLjczNyAxMCA0Mi4zMzcgMTAgTCAzOC42MzcgMTAgQyAzOC4yMzcgMTAgMzcuODM3IDEwLjQgMzguMDM3IDEwLjkgTCA0Mi4xMzcgMjMgTCAzOC4yMzcgMjguNCBDIDM3LjkzNyAyOC44IDM4LjIzNyAyOS40IDM4LjczNyAyOS40IEwgNDIuNDM3IDI5LjQgQyA0Mi44MzcgMjkuNCA0My4xMzcgMjkuMiA0My4zMzcgMjguOSBMIDU1LjgzNyAxMC45IEMgNTYuMTM3IDEwLjYgNTUuODM3IDEwIDU1LjMzNyAxMCBaIj48L3BhdGg+PHBhdGggZmlsbD0iIzAwOWNkZSIgZD0iTSA2Ny43MzcgMi44IEwgNTkuOTM3IDIuOCBDIDU5LjQzNyAyLjggNTguOTM3IDMuMiA1OC44MzcgMy43IEwgNTUuNzM3IDIzLjYgQyA1NS42MzcgMjQgNTUuOTM3IDI0LjMgNTYuMzM3IDI0LjMgTCA2MC4zMzcgMjQuMyBDIDYwLjczNyAyNC4zIDYxLjAzNyAyNCA2MS4wMzcgMjMuNyBMIDYxLjkzNyAxOCBDIDYyLjAzNyAxNy41IDYyLjQzNyAxNy4xIDYzLjAzNyAxNy4xIEwgNjUuNTM3IDE3LjEgQyA3MC42MzcgMTcuMSA3My42MzcgMTQuNiA3NC40MzcgOS43IEMgNzQuNzM3IDcuNiA3NC40MzcgNS45IDczLjQzNyA0LjcgQyA3Mi4yMzcgMy41IDcwLjMzNyAyLjggNjcuNzM3IDIuOCBaIE0gNjguNjM3IDEwLjEgQyA2OC4yMzcgMTIuOSA2Ni4wMzcgMTIuOSA2NC4wMzcgMTIuOSBMIDYyLjgzNyAxMi45IEwgNjMuNjM3IDcuNyBDIDYzLjYzNyA3LjQgNjMuOTM3IDcuMiA2NC4yMzcgNy4yIEwgNjQuNzM3IDcuMiBDIDY2LjEzNyA3LjIgNjcuNDM3IDcuMiA2OC4xMzcgOCBDIDY4LjYzNyA4LjQgNjguNzM3IDkuMSA2OC42MzcgMTAuMSBaIj48L3BhdGg+PHBhdGggZmlsbD0iIzAwOWNkZSIgZD0iTSA5MC45MzcgMTAgTCA4Ny4yMzcgMTAgQyA4Ni45MzcgMTAgODYuNjM3IDEwLjIgODYuNjM3IDEwLjUgTCA4Ni40MzcgMTEuNSBMIDg2LjEzNyAxMS4xIEMgODUuMzM3IDkuOSA4My41MzcgOS41IDgxLjczNyA5LjUgQyA3Ny42MzcgOS41IDc0LjEzNyAxMi42IDczLjQzNyAxNyBDIDczLjAzNyAxOS4yIDczLjUzNyAyMS4zIDc0LjgzNyAyMi43IEMgNzUuOTM3IDI0IDc3LjYzNyAyNC42IDc5LjUzNyAyNC42IEMgODIuODM3IDI0LjYgODQuNzM3IDIyLjUgODQuNzM3IDIyLjUgTCA4NC41MzcgMjMuNSBDIDg0LjQzNyAyMy45IDg0LjczNyAyNC4zIDg1LjEzNyAyNC4zIEwgODguNTM3IDI0LjMgQyA4OS4wMzcgMjQuMyA4OS41MzcgMjMuOSA4OS42MzcgMjMuNCBMIDkxLjYzNyAxMC42IEMgOTEuNjM3IDEwLjQgOTEuMzM3IDEwIDkwLjkzNyAxMCBaIE0gODUuNzM3IDE3LjIgQyA4NS4zMzcgMTkuMyA4My43MzcgMjAuOCA4MS41MzcgMjAuOCBDIDgwLjQzNyAyMC44IDc5LjYzNyAyMC41IDc5LjAzNyAxOS44IEMgNzguNDM3IDE5LjEgNzguMjM3IDE4LjIgNzguNDM3IDE3LjIgQyA3OC43MzcgMTUuMSA4MC41MzcgMTMuNiA4Mi42MzcgMTMuNiBDIDgzLjczNyAxMy42IDg0LjUzNyAxNCA4NS4xMzcgMTQuNiBDIDg1LjczNyAxNS4zIDg1LjkzNyAxNi4yIDg1LjczNyAxNy4yIFoiPjwvcGF0aD48cGF0aCBmaWxsPSIjMDA5Y2RlIiBkPSJNIDk1LjMzNyAzLjMgTCA5Mi4xMzcgMjMuNiBDIDkyLjAzNyAyNCA5Mi4zMzcgMjQuMyA5Mi43MzcgMjQuMyBMIDk1LjkzNyAyNC4zIEMgOTYuNDM3IDI0LjMgOTYuOTM3IDIzLjkgOTcuMDM3IDIzLjQgTCAxMDAuMjM3IDMuNSBDIDEwMC4zMzcgMy4xIDEwMC4wMzcgMi44IDk5LjYzNyAyLjggTCA5Ni4wMzcgMi44IEMgOTUuNjM3IDIuOCA5NS40MzcgMyA5NS4zMzcgMy4zIFoiPjwvcGF0aD48L3N2Zz4" alt="PayPal" role="presentation" class="paypal-logo" style="height: 24px; width: auto;">
                                    <span class="paypal-button-text" style="color: #000; font-weight: 600; font-size: 0.95em;">Checkout</span>
                                </div>
                                <div class="paypal-button-spinner"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Zelle -->
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <span style="color: #666;">Pay with Zelle:</span>
                        <div style="background: linear-gradient(135deg, #6D1ED4 0%, #8B3FE0 100%); padding: 12px 24px; border-radius: 4px; display: flex; align-items: center; gap: 10px; box-shadow: 0 2px 6px rgba(109, 30, 212, 0.2);">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 2L2 7L12 12L22 7L12 2Z" fill="white"/>
                                <path d="M2 17L12 22L22 17V12L12 17L2 12V17Z" fill="white"/>
                            </svg>
                            <span style="color: white; font-weight: 600; font-size: 0.95em;">202-468-2942</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p><strong>Thank you for your business!</strong></p>
            <p>For questions regarding this invoice, please contact: <span id="display-contactEmail">your.email@example.com</span></p>
            <p style="margin-top: 15px; font-size: 0.9em; color: #999; display: none;">
                Invoice generated on <span id="display-generatedDate">October 17, 2025</span>
            </p>
        </div>
    </div>

    <script>
        // Line items storage - dynamically managed by user
        let lineItems = [];

        // Render line items manager in control panel
        function renderLineItemsManager() {
            const container = document.getElementById('lineItemsManager');
            container.innerHTML = '';

            if (lineItems.length === 0) {
                container.innerHTML = '<p style="color: white; text-align: center; opacity: 0.7;">No line items yet. Click "Add Line Item" or "Auto-Generate from Period"</p>';
                return;
            }

            lineItems.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.style.cssText = 'background: white; padding: 15px; border-radius: 8px; display: grid; grid-template-columns: 150px 1fr 100px 80px; gap: 10px; align-items: center;';
                itemDiv.setAttribute('data-line-index', index);

                itemDiv.innerHTML = `
                    <div>
                        <label style="font-size: 0.8em; color: #666; display: block; margin-bottom: 4px;">Date</label>
                        <input type="date" value="${item.date}" data-field="date"
                               style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div>
                        <label style="font-size: 0.8em; color: #666; display: block; margin-bottom: 4px;">Description</label>
                        <input type="text" value="${item.description}" data-field="description"
                               style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div>
                        <label style="font-size: 0.8em; color: #666; display: block; margin-bottom: 4px;">Hours</label>
                        <input type="number" value="${item.hours}" step="0.5" data-field="hours"
                               style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <button class="remove-line-item-btn" data-index="${index}"
                            style="background: #dc2626; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 1.2em; height: 38px; align-self: end;"
                            title="Remove this line item">üóëÔ∏è</button>
                `;

                // Add event listeners for inputs
                const dateInput = itemDiv.querySelector('[data-field="date"]');
                const descInput = itemDiv.querySelector('[data-field="description"]');
                const hoursInput = itemDiv.querySelector('[data-field="hours"]');

                dateInput.addEventListener('change', function() {
                    updateLineItemDate(index, this.value);
                });

                descInput.addEventListener('change', function() {
                    updateLineItemDescription(index, this.value);
                });

                hoursInput.addEventListener('change', function() {
                    updateLineItemHours(index, this.value);
                });

                // Add event listener for delete button
                const deleteBtn = itemDiv.querySelector('.remove-line-item-btn');
                deleteBtn.addEventListener('click', function() {
                    removeLineItem(index);
                });

                container.appendChild(itemDiv);
            });
        }

        // Add a new line item
        function addNewLineItem() {
            const startDate = document.getElementById('periodStart').value || new Date().toISOString().split('T')[0];
            
            lineItems.push({
                date: startDate,
                description: 'Delegating Nurse Services',
                hours: 10.0
            });
            
            renderLineItemsManager();
            updateInvoice();
        }

        // Remove a line item
        function removeLineItem(index) {
            if (confirm('Remove this line item?')) {
                lineItems.splice(index, 1);
                renderLineItemsManager();
                updateInvoice();
            }
        }

        // Update line item date
        function updateLineItemDate(index, value) {
            lineItems[index].date = value;
            updateInvoice();
        }

        // Update line item description
        function updateLineItemDescription(index, value) {
            lineItems[index].description = value;
            updateInvoice();
        }

        // Update line item hours
        function updateLineItemHours(index, value) {
            lineItems[index].hours = parseFloat(value) || 0;
            updateInvoice();
        }

        // Auto-generate line items based on billing period
        function autoGenerateLineItems() {
            const startDate = new Date(document.getElementById('periodStart').value);
            const endDate = new Date(document.getElementById('periodEnd').value);
            
            if (!startDate || !endDate) {
                alert('Please set Period Start and End dates first!');
                return;
            }
            
            if (lineItems.length > 0 && !confirm('This will replace existing line items. Continue?')) {
                return;
            }
            
            // Calculate number of weeks in the period
            const millisecondsPerDay = 1000 * 60 * 60 * 24;
            const days = Math.round((endDate - startDate) / millisecondsPerDay) + 1;
            const weeks = Math.ceil(days / 7);
            
            // Clear existing line items
            lineItems = [];
            
            // Generate line items for each week
            for (let i = 0; i < weeks; i++) {
                const weekDate = new Date(startDate);
                weekDate.setDate(startDate.getDate() + (i * 7));
                
                // Format date as YYYY-MM-DD
                const dateStr = weekDate.toISOString().split('T')[0];
                
                lineItems.push({
                    date: dateStr,
                    description: `Delegating Nurse Services - Week ${i + 1}`,
                    hours: 10.0
                });
            }
            
            renderLineItemsManager();
            updateInvoice();
        }

        // Generate automatic invoice number
        function generateInvoiceNumber() {
            const invoiceDate = new Date(document.getElementById('invoiceDate').value);
            const year = invoiceDate.getFullYear();
            const month = String(invoiceDate.getMonth() + 1).padStart(2, '0');
            const day = String(invoiceDate.getDate()).padStart(2, '0');
            
            // Get or create counter for this year-month
            const storageKey = `invoice_counter_${year}_${month}`;
            let counter = localStorage.getItem(storageKey);
            
            if (!counter) {
                counter = 1;
            } else {
                counter = parseInt(counter) + 1;
            }
            
            // Store the new counter
            localStorage.setItem(storageKey, counter);
            
            // Format: INV-YYYY-MM-NNN (e.g., INV-2025-10-001)
            const invoiceNumber = `INV-${year}-${month}-${String(counter).padStart(3, '0')}`;
            
            return invoiceNumber;
        }

        // Reset counter for a specific month (utility function)
        function resetInvoiceCounter() {
            const invoiceDate = new Date(document.getElementById('invoiceDate').value);
            const year = invoiceDate.getFullYear();
            const month = String(invoiceDate.getMonth() + 1).padStart(2, '0');
            const storageKey = `invoice_counter_${year}_${month}`;
            
            if (confirm(`Reset invoice counter for ${month}/${year}? This will start the next invoice at 001.`)) {
                localStorage.removeItem(storageKey);
                alert('Counter reset successfully!');
                updateInvoiceNumber();
            }
        }

        function updateInvoiceNumber() {
            const invoiceNumber = generateInvoiceNumber();
            document.getElementById('invoiceNumber').value = invoiceNumber;
        }

        function formatDate(dateString) {
            // Parse date without timezone conversion
            // Input format: YYYY-MM-DD from date input
            const [year, month, day] = dateString.split('-');
            const date = new Date(year, month - 1, day);
            return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: '2-digit' });
        }

        function formatCurrency(amount) {
            return amount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        function calculateTotal() {
            const rate = parseFloat(document.getElementById('hourlyRate').value) || 0;
            let subtotal = 0;
            
            lineItems.forEach(item => {
                subtotal += item.hours * rate;
            });

            const tax = 0; // Can be modified if needed
            const total = subtotal + tax;

            document.getElementById('display-subtotal').textContent = formatCurrency(subtotal);
            document.getElementById('display-tax').textContent = formatCurrency(tax);
            document.getElementById('display-total').textContent = formatCurrency(total);
        }

        function renderLineItems() {
            const rate = parseFloat(document.getElementById('hourlyRate').value) || 0;
            const tbody = document.getElementById('lineItemsTable');
            tbody.innerHTML = '';

            lineItems.forEach((item, index) => {
                const amount = item.hours * rate;
                const row = document.createElement('tr');
                row.setAttribute('data-line-index', index);
                row.innerHTML = `
                    <td>${formatDate(item.date)}</td>
                    <td>${item.description}</td>
                    <td style="text-align: center;">${item.hours.toFixed(1)}</td>
                    <td class="amount-column">$${formatCurrency(rate)}</td>
                    <td class="amount-column">$${formatCurrency(amount)}</td>
                `;
                tbody.appendChild(row);
            });

            calculateTotal();
        }

        function addLineItem() {
            const newDate = prompt('Enter date (YYYY-MM-DD):', '2025-10-01');
            if (!newDate) return;

            const description = prompt('Enter service description:', 'Delegating Nurse Services');
            if (!description) return;

            const hours = parseFloat(prompt('Enter hours worked:', '8.0'));
            if (isNaN(hours)) return;

            lineItems.push({ date: newDate, description, hours });
            renderLineItems();
        }

        function downloadPDF() {
            // Open browser's print dialog, which allows saving as PDF
            window.print();
        }

        function updateInvoice() {
            // Update all display fields
            document.getElementById('display-contractorName').textContent = document.getElementById('contractorName').value;
            document.getElementById('display-position').textContent = document.getElementById('position').value;
            document.getElementById('display-license').textContent = document.getElementById('license').value;
            document.getElementById('display-contractorEmail').textContent = document.getElementById('contractorEmail').value;
            document.getElementById('display-contractorPhone').textContent = document.getElementById('contractorPhone').value;
            
            document.getElementById('display-facilityName').textContent = document.getElementById('facilityName').value;
            document.getElementById('display-attention').textContent = document.getElementById('attention').value;
            document.getElementById('display-facilityAddress').textContent = document.getElementById('facilityAddress').value;
            document.getElementById('display-facilityEmail').textContent = document.getElementById('facilityEmail').value;
            document.getElementById('display-facilityPhone').textContent = document.getElementById('facilityPhone').value;
            
            document.getElementById('display-invoiceNumber').textContent = document.getElementById('invoiceNumber').value;
            document.getElementById('display-invoiceDate').textContent = formatDate(document.getElementById('invoiceDate').value);
            
            const periodStart = formatDate(document.getElementById('periodStart').value);
            const periodEnd = formatDate(document.getElementById('periodEnd').value);
            document.getElementById('display-billingPeriod').textContent = `${periodStart} - ${periodEnd}`;
            
            document.getElementById('display-dueDate').textContent = formatDate(document.getElementById('dueDate').value);
            document.getElementById('display-hourlyRate').textContent = formatCurrency(parseFloat(document.getElementById('hourlyRate').value));
            
            const paymentInfo = document.getElementById('paymentInfo').value;
            document.getElementById('display-paymentInfo').innerHTML = `
                ${paymentInfo.replace(/\n/g, '<br>')}
            `;
            
            document.getElementById('display-contactEmail').textContent = document.getElementById('contractorEmail').value;
            
            const today = new Date();
            document.getElementById('display-generatedDate').textContent = today.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });

            // Re-render line items with new rate and dates
            renderLineItems();
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateInvoiceNumber();
            renderLineItemsManager(); // Render the line items manager
            updateInvoice();

            // Add event listeners for buttons (avoiding inline onclick for CSP compatibility)
            document.getElementById('updateInvoiceBtn').addEventListener('click', updateInvoice);
            document.getElementById('printInvoiceBtn').addEventListener('click', function() {
                window.print();
            });
            document.getElementById('downloadPDFBtn').addEventListener('click', downloadPDF);
            document.getElementById('autoGenerateBtn').addEventListener('click', autoGenerateLineItems);
            document.getElementById('resetCounterBtn').addEventListener('click', resetInvoiceCounter);
            document.getElementById('addLineItemBtn').addEventListener('click', addNewLineItem);

            // Initialize floating labels
            const formGroups = document.querySelectorAll('.form-group');

            formGroups.forEach(group => {
                const input = group.querySelector('input, select, textarea');
                if (!input) return;

                // Check initial value and add has-value class if needed
                function updateLabelState() {
                    if (input.value && input.value.trim() !== '') {
                        group.classList.add('has-value');
                    } else {
                        group.classList.remove('has-value');
                    }
                }

                // Update on initial load
                updateLabelState();

                // Update on input change
                input.addEventListener('input', updateLabelState);
                input.addEventListener('change', updateLabelState);

                // Special handling for date inputs
                if (input.type === 'date') {
                    input.addEventListener('blur', updateLabelState);
                }

                // Special handling for selects
                if (input.tagName === 'SELECT') {
                    input.addEventListener('change', function() {
                        if (input.value !== '') {
                            group.classList.add('has-value');
                        } else {
                            group.classList.remove('has-value');
                        }
                    });
                }
            });
        });

        // Update invoice number when invoice date changes
        document.getElementById('invoiceDate').addEventListener('change', function() {
            updateInvoiceNumber();
            updateInvoice();
        });

        // Update line items manager when period dates change (useful for auto-generation)
        document.getElementById('periodStart').addEventListener('change', function() {
            renderLineItemsManager();
        });

        document.getElementById('periodEnd').addEventListener('change', function() {
            renderLineItemsManager();
        });
    </script>
</body>
</html>